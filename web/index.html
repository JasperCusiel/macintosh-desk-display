<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>Spotify Currently Playing</title>
    <meta name="description" content="" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="css/style.css" type="text/css" />
  </head>
  <body>
    <script type="text/javascript" src="/eel.js"></script>
    <div id="album-art-background"></div>
    <div id="now-playing-layout">
      <div id="album-art-container">
        <img id="album-art" src="/artwork-placeholder.png" alt="Cover Art" />
      </div>
      <div id="track-container">
        <span id="track" text="track"></span>
      </div>
      <div id="artist-container">
        <span id="artist" text="artist"></span>
      </div>
      <div id="album-container">
        <span id="album" text="album"></span>
      </div>
    </div>
    <script type="text/javascript">
      let prevAlbumArtUrl = ""; // Declare the variable outside the function
      function updateImage() {
        eel.get_image_url()((data) => {
          const artistName = data.artist_name;
          const songTitle = data.song_title;
          const albumName = data.album_name;
          const length = data.length;
          const progress = data.progress;
          const albumArtUrl = data.album_art_url;
          if (prevAlbumArtUrl !== albumArtUrl) {
            // Use the values to update the UI
            document.getElementById("artist").innerText = artistName;
            document.getElementById("track").innerText = songTitle;
            document.getElementById("album").innerText = albumName;

            const albumArt = document.getElementById("album-art");
            const albumBackground = document.getElementById(
              "album-art-background"
            );
            albumArt.style.opacity = 0; // Fade out the current image
            albumBackground.style.opacity = 0;
            albumArt.addEventListener("transitionend", () => {
              albumArt.src = albumArtUrl; // Update the image source
              albumBackground.style.backgroundImage = `url(${albumArtUrl})`;
              albumArt.onload = () => {
                albumArt.style.opacity = 1; // Fade in the new image
                albumBackground.style.opacity = 1;
              };
            });
          }
          prevAlbumArtUrl = albumArtUrl;
        });
      }

      // Call the updateImage function every 5 seconds
      setInterval(updateImage, 5000);
    </script>
  </body>
</html>
